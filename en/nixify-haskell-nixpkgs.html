<!DOCTYPE html>
<!-- DoNotFormat -->
<!-- DoNotFormat -->




<!-- DoNotFormat -->
<!-- DoNotFormat -->

<html lang='en'>

<head>
  <meta charset='UTF-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <title>
    Nixifying a Haskell project using nixpkgs – NixOS Asia
  </title>
  
    
      <meta property='og:description' content='Welcome to the [[nixify-haskell]] series, where we start our journey by integrating a Haskell application, particularly one using a PostgreSQL database, into a single-command deployable package. By the end of this article, you’ll have a flake.nix file that’s set to build the project, establish the development environment, and execute the Haskell application along with all its dependent services like PostgreSQL and PostgREST. We’ll be using todo-app as a running case study throughout the series, demonstrating the process of building a Haskell project and effectively managing runtime dependencies, such as databases and other services, thereby illustrating the streamlined and powerful capabilities Nix introduces to Haskell development.' />
      <meta property='og:site_name' content='NixOS Asia' />
      <meta property='og:image' content='https://nixos.asia/en/static/nixos-asia.svg' />
      <meta property='og:type' content='website' />
      <meta property='og:title' content='Nixifying a Haskell project using nixpkgs' />
      
        <meta name='twitter:card' content='summary_large_image' />
      
    
    
      <base href='/en/' />
      <link href='static/nixos-asia.svg' rel='icon' />
    
    <meta name='generator' content='Emanote' />

  
  
  <link href='tailwind.css?instanceId=71ee7dbc-bd51-4884-b69b-c6918d13f869' rel='stylesheet' type='text/css' />

  <link rel='stylesheet' href='_emanote-static/skylighting.css' />

<style data-category='global-font'>
  /* Refined typography with system font stack */
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.7;
    letter-spacing: 0.01em;
  }

  h1, h2, h3, h4, h5, h6 {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    letter-spacing: -0.02em;
    line-height: 1.3;
    font-weight: 700;
  }
</style>


<style data-category='error'>
  /* Heist error element */
  strong.error {
    color: lightcoral;
    font-size: 90%;
    font-family: monospace;
  }
</style>

<style data-category='kbd'>
  /* <kbd> styling */
  kbd {
    background-color: #f7f7f7;
    border-radius: 6px;
    border: 1px solid #d1d5db;
    box-shadow:
      0 1px 2px rgba(0, 0, 0, 0.1),
      0 2px 0 0 rgba(255, 255, 255, 0.8) inset;
    display: inline-block;
    line-height: 1.2;
    padding: 3px 6px;
    white-space: nowrap;
    font-size: 0.9em;
  }

  /* Dark mode kbd styling */
  .dark kbd {
    background-color: #374151;
    border: 1px solid #4b5563;
    box-shadow:
      0 1px 2px rgba(0, 0, 0, 0.4),
      0 2px 0 0 rgba(255, 255, 255, 0.08) inset;
    color: #f3f4f6;
  }
</style>

<style data-category='callout'>
  /* To prevent overemphasis of link styles in callout titles */
  .callout .callout-title a {
    color: inherit;
    text-decoration: underline;
  }
</style>

<style data-category='toc'>
  a.--ema-toc {
    background-color: transparent !important;
  }

  /* Active TOC item styling */
  a.--ema-toc.toc-item-active {
    font-weight: 600;
    border-left: 3px solid #3b82f6;
    padding-left: calc(0.5rem - 3px) !important;
  }

  /* Light mode active state */
  a.--ema-toc.toc-item-active {
    background-color: #eff6ff !important;
    color: #1d4ed8 !important;
  }

  /* Dark mode active state */
  .dark a.--ema-toc.toc-item-active {
    background-color: #172554 !important;
    color: #93c5fd !important;
    border-left-color: #3b82f6;
  }
</style>

<style data-category='global-improvements'>
  /* Link improvements */
  a {
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  /* Focus states for accessibility */
  a:focus-visible, button:focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 2px;
    border-radius: 2px;
  }

  /* Code block enhancements */
  pre {
    position: relative;
  }

  pre code {
    display: block;
    line-height: 1.6;
  }

  /* Copy button for code blocks */
  .code-copy-button {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    color: #374151;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.15s ease, background-color 0.15s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .code-copy-button svg {
    width: 1rem;
    height: 1rem;
  }

  .dark .code-copy-button {
    background: rgba(31, 41, 55, 0.9);
    border-color: #4b5563;
    color: #d1d5db;
  }

  pre:hover .code-copy-button {
    opacity: 1;
  }

  .code-copy-button:hover {
    background: rgba(255, 255, 255, 1);
  }

  .dark .code-copy-button:hover {
    background: rgba(31, 41, 55, 1);
  }

  .code-copy-button:active {
    transform: scale(0.95);
  }
</style>

<script>
  // Add copy buttons to code blocks
  document.addEventListener('DOMContentLoaded', function() {
    const copyIcon = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>';
    const checkIcon = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';

    document.querySelectorAll('pre code').forEach(function(codeBlock) {
      const pre = codeBlock.parentElement;

      // Create copy button
      const button = document.createElement('button');
      button.className = 'code-copy-button';
      button.innerHTML = copyIcon;
      button.setAttribute('aria-label', 'Copy code to clipboard');
      button.setAttribute('title', 'Copy code');

      button.addEventListener('click', function() {
        const text = codeBlock.textContent;
        navigator.clipboard.writeText(text).then(function() {
          button.innerHTML = checkIcon;
          button.setAttribute('title', 'Copied!');
          setTimeout(function() {
            button.innerHTML = copyIcon;
            button.setAttribute('title', 'Copy code');
          }, 2000);
        }).catch(function(err) {
          console.error('Copy failed:', err);
          button.setAttribute('title', 'Copy failed');
          setTimeout(function() {
            button.innerHTML = copyIcon;
            button.setAttribute('title', 'Copy code');
          }, 2000);
        });
      });

      pre.appendChild(button);
    });
  });
</script>

<style data-category='external-link'>
  /* External link icon */
  a[data-linkicon=""]::after {
    content: ""
  }

  a[data-linkicon=none]::after {
    content: ""
  }

  a[data-linkicon="external"] {
    padding-right: 24px;
  }

  a[data-linkicon="external"]::after {
    margin-right: -24px;
    content: url('data:image/svg+xml,\
      <svg xmlns="http://www.w3.org/2000/svg" height="0.7em" viewBox="0 0 20 20"> \
        <g style="stroke:gray;stroke-width:1"> \
          <line x1="5" y1="5" x2="5" y2="14" /> \
          <line x1="14" y1="9" x2="14" y2="14" /> \
          <line x1="5" y1="14" x2="14" y2="14" /> \
          <line x1="5" y1="5" x2="9" y2="5"  /> \
          <line x1="10" y1="2" x2="17" y2="2"  /> \
          <line x1="17" y1="2" x2="17" y2="9" /> \
          <line x1="10" y1="9" x2="17" y2="2" style="stroke-width:1.0" /> \
        </g> \
      </svg>');
  }

  .dark a[data-linkicon="external"]::after {
    content: url('data:image/svg+xml,\
      <svg xmlns="http://www.w3.org/2000/svg" height="0.7em" viewBox="0 0 20 20"> \
        <g style="stroke:lightgray;stroke-width:1"> \
          <line x1="5" y1="5" x2="5" y2="14" /> \
          <line x1="14" y1="9" x2="14" y2="14" /> \
          <line x1="5" y1="14" x2="14" y2="14" /> \
          <line x1="5" y1="5" x2="9" y2="5"  /> \
          <line x1="10" y1="2" x2="17" y2="2"  /> \
          <line x1="17" y1="2" x2="17" y2="9" /> \
          <line x1="10" y1="9" x2="17" y2="2" style="stroke-width:1.0" /> \
        </g> \
      </svg>');
  }

  a[data-linkicon="external"][href^="mailto:"]::after {
    content: url('data:image/svg+xml,\
        <svg \
          xmlns="http://www.w3.org/2000/svg" \
          height="0.7em" \
          fill="none" \
          viewBox="0 0 24 24" \
          stroke="gray" \
          stroke-width="2"> \
          <path \
            stroke-linecap="round" \
            stroke-linejoin="round" \
            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /> \
        </svg>');
  }

  .dark a[data-linkicon="external"][href^="mailto:"]::after {
    content: url('data:image/svg+xml,\
        <svg \
          xmlns="http://www.w3.org/2000/svg" \
          height="0.7em" \
          fill="none" \
          viewBox="0 0 24 24" \
          stroke="lightgray" \
          stroke-width="2"> \
          <path \
            stroke-linecap="round" \
            stroke-linejoin="round" \
            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /> \
        </svg>');
  }
</style>
  <!-- What goes in this file will appear on near the end of <head>-->

  
    <style>
      /* For use in sidebar.tpl, as we cannot achieve this in tailwind itself! */
      /* md:min-w-52  */
      @media (min-width: 768px) {
        #sidebar {
          min-width: 13rem;
        }
      }

      /* xl:min-w-72  */
      @media (min-width: 1280px) {
        #sidebar {
          min-width: 18rem;
        }
      }
    </style>

    
      <link rel='stylesheet' href='_emanote-static/inverted-tree.css' />
    
  
  <!-- Custom Stork-search styling for Emanote --><link rel='stylesheet' href='_emanote-static/stork/edible.css' media='(prefers-color-scheme: light)' />
<link rel='stylesheet' href='_emanote-static/stork/edible-dark.css' media='(prefers-color-scheme: dark)' />

<style data-category='stork'>
  #stork-search-container {
    z-index: 1000;
    background-color: rgb(15 23 42/.8);
  }

  .stork-overflow-hidden-important {
    overflow: hidden !important;
  }
</style>


<script src='_emanote-static/stork/stork.js'></script>

  
    <script id='emanote-stork' data-emanote-base-url='/en/'>
      window.emanote = {};
      window.emanote.stork = {
        searchShown: false,
        indexIsStale: false,
        toggleSearch: function () {
          window.emanote.stork.refreshIndex();
          document.getElementById('stork-search-container').classList.toggle('hidden');
          window.emanote.stork.searchShown = document.body.classList.toggle('stork-overflow-hidden-important');
          if (window.emanote.stork.searchShown) {
            document.getElementById('stork-search-input').focus();
          }
        },
        clearSearch: function () {
          document.getElementById('stork-search-container').classList.add('hidden');
          document.body.classList.remove('stork-overflow-hidden-important');
          window.emanote.stork.searchShown = false;
        },

        getBaseUrl: function () {
          const baseUrl = document.getElementById("emanote-stork").getAttribute('data-emanote-base-url') || '/';
          return baseUrl;
        },

        registerIndex: function (options) {
          const indexName = 'emanote-search'; // used to match input[data-stork] attribute value
          const indexUrl = window.emanote.stork.getBaseUrl() + '-/stork.st';
          stork.register(
            indexName,
            indexUrl,
            options);
        },

        init: function () {
          if (document.readyState !== 'complete') {
            window.addEventListener('load', function () {
              stork.initialize(window.emanote.stork.getBaseUrl() + '_emanote-static/stork/stork.wasm');
              window.emanote.stork.registerIndex();
            });

            document.addEventListener('keydown', event => {
              if (window.emanote.stork.searchShown && event.key === 'Escape') {
                window.emanote.stork.clearSearch();
                event.preventDefault();
              } else if ((event.key == 'k' || event.key == 'K') && (event.ctrlKey || event.metaKey)) {
                window.emanote.stork.toggleSearch();
                event.preventDefault();
              }
            });
          } else {
            // This section is called during Ema's hot reload.
            //
            // Mark the current index as stale, and refresh it *only when* the
            // user actually invokes search.
            //
            // We do not refresh the index *right away*, as that will cause
            // memory leaks in the browser. See
            // https://github.com/srid/emanote/issues/411#issuecomment-1402056235
            console.log("stork: Marking index as stale");
            window.emanote.stork.markIndexAsStale();
          }
        },

        markIndexAsStale: function () {
          window.emanote.stork.indexIsStale = true;
        },

        refreshIndex: function () {
          if (window.emanote.stork.indexIsStale) {
            console.log("stork: Reloading index");
            window.emanote.stork.indexIsStale = false;
            // NOTE: This will leak memory. See the comment above.
            window.emanote.stork.registerIndex({ forceOverwrite: true });
          }
        }

      };

      window.emanote.stork.init();
    </script>
  

</head>

<!-- DoNotFormat -->



<!-- DoNotFormat -->

<body class='bg-gray-200 dark:bg-black text-gray-900 dark:text-gray-50 overflow-y-scroll'>
  
    <div class='container mx-auto max-w-screen-lg mt-2 md:mt-4  '>
      
        <!-- DoNotFormat -->
<!-- DoNotFormat -->

<nav id='uptree' class='flipped tree font-medium' style='transform-origin: 50%;'>
  <ul class='root'>
    <li>
      
        <ul>
          
            <li>

  <a href='nixify-haskell'>
    <div class='bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-green-500 dark:hover:bg-green-600 hover:text-white cursor-pointer transition-all duration-150 forest-link'>
      Nixify Haskell projects
    </div>
  </a>

  
    <ul>
      
        <li>

  <a href='haskell'>
    <div class='bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-green-500 dark:hover:bg-green-600 hover:text-white cursor-pointer transition-all duration-150 forest-link'>
      Haskell
    </div>
  </a>

  
    <ul>
      
        <li>

  <a href='dev'>
    <div class='bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-green-500 dark:hover:bg-green-600 hover:text-white cursor-pointer transition-all duration-150 forest-link'>
      Nix for Development
    </div>
  </a>

  
    <ul>
      
        <li>

  <a href='nix'>
    <div class='bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-green-500 dark:hover:bg-green-600 hover:text-white cursor-pointer transition-all duration-150 forest-link'>
      Nix
    </div>
  </a>

  
    <ul>
      
        <li>

  <a href='topics'>
    <div class='bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-green-500 dark:hover:bg-green-600 hover:text-white cursor-pointer transition-all duration-150 forest-link'>
      Topics
    </div>
  </a>

  
    <ul>
      
        <li>

  <a href='/en/'>
    <div class='bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-green-500 dark:hover:bg-green-600 hover:text-white cursor-pointer transition-all duration-150 forest-link'>
      NixOS Asia
    </div>
  </a>

  
</li>
      
    </ul>
  
</li>
      
    </ul>
  
</li>
      
    </ul>
  
</li>
      
    </ul>
  
</li>
      
        <li>

  <a href='tutorial'>
    <div class='bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 hover:bg-green-500 dark:hover:bg-green-600 hover:text-white cursor-pointer transition-all duration-150 forest-link'>
      Tutorials
    </div>
  </a>

  
</li>
      
    </ul>
  
</li>
          
        </ul>
      
    </li>
  </ul>
</nav>
      

      
        <nav id='breadcrumbs' class='w-full text-gray-700 dark:text-gray-300 md:hidden'>
  <div class='flex justify-left'>
    <div class='w-full px-4 py-3 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800'>
      <ul class='flex flex-wrap text-base'>
        <li class='inline-flex items-center'>
          
            
              <img style='width: 1rem;' src='static/nixos-asia.svg' alt='Site Icon' />
            
          
        </li>
        
          
            <li class='inline-flex items-center'>
              <a class='px-1 font-bold' href='/en/'>
                NixOS Asia
              </a>
              <svg fill='currentColor' viewBox='0 0 20 20' class='w-auto h-5 text-gray-400 dark:text-gray-500'>
                <path fill-rule='evenodd' d='M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z' clip-rule='evenodd'></path>
              </svg>
            </li>
          
        
      </ul>
    </div>
    <button class='inline px-3 py-2 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 outline-none cursor-pointer focus:outline-none hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors' title='Search (Ctrl+K)' type='button' onclick='window.emanote.stork.toggleSearch()'>
      <svg xmlns='http://www.w3.org/2000/svg' style='width: 1rem;' class='hover:text-green-700' f
 fill='none' viewBox='0 0 24 24' stroke='currentColor' stroke-width='2'>
  <path stroke-linecap='round' stroke-linejoin='round' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'></path>
</svg>
    </button>
    <button class='inline px-3 py-2 text-white bg-green-600 dark:bg-green-700 outline-none cursor-pointer focus:outline-none hover:bg-green-700 dark:hover:bg-green-800 transition-colors' title='Toggle sidebar' type='button' onclick="toggleHidden('sidebar')">
      <svg xmlns='http://www.w3.org/2000/svg' class='w-4' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M4 6h16M4 12h16M4 18h16'></path>
      </svg>
    </button>
    <script>
      function toggleHidden(elemId) {
        document.getElementById(elemId).classList.toggle("hidden");
      }
    </script>
  </div>
</nav>
      

      
        <div id='container' class='relative md:shadow-md md:rounded-lg md:mb-8 bg-white dark:bg-gray-900 md:border md:border-gray-200 dark:md:border-gray-800'>
          
  <div class='absolute -top-6 right-1 md:right-0 flex flex-row items-center justify-center'>
    <button title='Search (Ctrl+K)' class='cursor-pointer' onclick='window.emanote.stork.toggleSearch()'>
      <svg xmlns='http://www.w3.org/2000/svg' style='width: 1rem;' class='hover:text-green-700' f
 fill='none' viewBox='0 0 24 24' stroke='currentColor' stroke-width='2'>
  <path stroke-linecap='round' stroke-linejoin='round' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'></path>
</svg>
    </button>
  </div>

          <!-- Main body column -->
          <div class='flex-1 w-full bg-white dark:bg-gray-800'>
  <main class='px-6 py-8 max-w-7xl mx-auto'>
    <h1 class='mb-10 px-8 py-5 bg-green-600 dark:bg-green-800 text-5xl font-bold text-white text-center rounded-2xl'>
  Nixifying a Haskell project using nixpkgs
</h1>
    
      <article class='overflow-auto'>
  <!-- What goes in this file will appear on top of note body-->
  










    <p class='mb-4 leading-relaxed'>
      Welcome to the <a href='nixify-haskell' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>Nixify Haskell projects</a> series, where we start our journey by integrating a Haskell application, particularly one using a PostgreSQL database, into a single-command deployable package. By the end of this article, you’ll have a <a href='flakes' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>flake.nix</a> file that’s set to build the project, establish the <a href='dev' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>development environment</a>, and execute the Haskell application along with all its dependent services like PostgreSQL and <a href='https://postgrest.org/en/stable' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'>PostgREST</a>. We’ll be using <a href='https://github.com/juspay/todo-app/tree/903c769d4bda0a8028fe3775415e9bdf29d80555' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'>todo-app</a> as a running case study throughout the series, demonstrating the process of building a Haskell project and effectively managing runtime dependencies, such as databases and other services, thereby illustrating the streamlined and powerful capabilities Nix introduces to Haskell development.
    </p>
  <div data-callout-metadata data-callout-fold data-callout='warning' class='callout bg-opacity-5 bg-[#f5f5f5] dark:bg-gray-900 p-5 pt-4 pb-3 rounded-xl mb-6 border-l-4 border-gray-200 dark:border-gray-700 shadow-sm' role='note' style='background-color: #EC750010; border-left-color: #EC7500'>
  <path d='M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z'>
  </path>
  <div class='callout-title flex items-center mb-3 font-semibold text-lg' style='color: #EC7500'>
    <div class='callout-icon flex-shrink-0'>
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='w-5 h-5'>
        
    <path d='m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z'></path>
    <line x1='12' y1='9' x2='12' y2='13'></line>
    <line x1='12' y1='17' x2='12.01' y2='17'></line>
  
      </svg>
    </div>
    <div class='ml-3'>
       Pre-requisites
    </div>
  </div>
  <div class='callout-content text-gray-700 dark:text-gray-300'>
    
    <ul class='my-4 ml-6 space-y-2 list-disc leading-relaxed'>
      
        <li>
          A basic understanding of the <a href='nix' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>Nix</a> and <a href='flakes' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>Flakes</a> is assumed. See <a href='nix-rapid' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>Rapid Introduction to Nix</a>
        </li>
      
        <li>
          To appreciate why Nix is a great choice for Haskell development, see <a href='why-dev' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>Why Choose Nix for develoment?</a>
        </li>
      
    </ul>
  
  </div>
</div>
    <h2 id='nixify-haskell-package' class='group mt-12 mb-6 font-bold text-gray-900 dark:text-gray-50 pb-2 border-b-2 border-gray-200 dark:border-gray-800 text-4xl'>
      
  Nixify Haskell package
  
  <a href='nixify-haskell-nixpkgs#nixify-haskell-package' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h2>
  
    <p class='mb-4 leading-relaxed'>
      Let’s build a simple flake for our Haskell project, <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>todo-app</code>. Start by cloning the <a href='https://github.com/juspay/todo-app/tree/903c769d4bda0a8028fe3775415e9bdf29d80555' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'>todo-app</a> repository and checking out the specified commit.
    </p>
  <div class='py-4 pr-4 mb-6 text-sm font-mono rounded-lg overflow-x-auto'><pre><code class='sh'><span class='fu'>git</span> clone https://github.com/juspay/todo-app.git
<span class='bu'>cd</span> todo-app
<span class='fu'>git</span> checkout 076185e34f70e903b992b597232bc622eadfcd51
</code></pre></div>
    <p class='mb-4 leading-relaxed'>
      Here’s a brief look at the <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>flake.nix</code> for this purpose:
    </p>
  <div class='py-4 pr-4 mb-6 text-sm font-mono rounded-lg overflow-x-auto'><pre><code class='nix'><span class='op'>{</span>
  <span class='va'>inputs</span> <span class='op'>=</span> <span class='op'>{</span>
    <span class='va'>nixpkgs</span>.<span class='va'>url</span> <span class='op'>=</span> <span class='st'>"github:NixOS/nixpkgs/nixpkgs-unstable"</span><span class='op'>;</span>
  <span class='op'>};</span>
  <span class='va'>outputs</span> <span class='op'>=</span> <span class='op'>{</span> <span class='va'>self</span><span class='op'>,</span> <span class='va'>nixpkgs</span> <span class='op'>}</span>:
    <span class='kw'>let</span>
      <span class='va'>system</span> <span class='op'>=</span> <span class='st'>"aarch64-darwin"</span><span class='op'>;</span>
      <span class='va'>pkgs</span> <span class='op'>=</span> nixpkgs<span class='op'>.</span>legacyPackages<span class='op'>.</span><span class='sc'>${</span>system<span class='sc'>}</span><span class='op'>;</span>
      <span class='va'>overlay</span> <span class='op'>=</span> <span class='va'>final</span><span class='op'>:</span> <span class='va'>prev</span><span class='op'>:</span> <span class='op'>{</span>
        <span class='va'>todo-app</span> <span class='op'>=</span> final<span class='op'>.</span>callCabal2nix <span class='st'>"todo-app"</span> <span class='ss'>./.</span> <span class='op'>{</span> <span class='op'>};</span>
      <span class='op'>};</span>
      <span class='va'>myHaskellPackages</span> <span class='op'>=</span> pkgs<span class='op'>.</span>haskellPackages<span class='op'>.</span>extend overlay<span class='op'>;</span>
    <span class='kw'>in</span>
    <span class='op'>{</span>
      <span class='va'>packages</span>.<span class='sc'>${</span>system<span class='sc'>}</span>.<span class='va'>default</span> <span class='op'>=</span> myHaskellPackages<span class='op'>.</span>todo<span class='op'>-</span>app<span class='op'>;</span>
      <span class='va'>apps</span>.<span class='sc'>${</span>system<span class='sc'>}</span>.<span class='va'>default</span> <span class='op'>=</span> <span class='op'>{</span>
        <span class='va'>type</span> <span class='op'>=</span> <span class='st'>"app"</span><span class='op'>;</span>
        <span class='va'>program</span> <span class='op'>=</span> <span class='st'>"</span><span class='sc'>${</span>self<span class='op'>.</span>packages<span class='op'>.</span><span class='sc'>${</span>system<span class='sc'>}</span><span class='op'>.</span>default<span class='sc'>}</span><span class='st'>/bin/todo-app"</span><span class='op'>;</span>
      <span class='op'>};</span>
    <span class='op'>};</span>
<span class='op'>}</span>
</code></pre></div>
    <p class='mb-4 leading-relaxed'>
      Now, let’s dissect it.
    </p>
  
    <h3 id='haskellpackages' class='group mt-10 mb-5 font-semibold text-gray-900 dark:text-gray-50 text-3xl'>
      
  haskellPackages
  
  <a href='nixify-haskell-nixpkgs#haskellpackages' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h3>
  
    <p class='mb-4 leading-relaxed'>
      The <a href='https://nixos.org/manual/nixpkgs/stable/#haskell' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'>official manual</a> explains the Haskell’s infrastructure in <a href='nixpkgs' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>nixpkgs</a> detail. For our purposes, the main things to understand are:
    </p>
  
    <ul class='my-4 ml-6 space-y-2 list-disc leading-relaxed'>
      
        <li>
          <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>pkgs.haskellPackages</code> is an attribute set containing all Haskell packages within <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>nixpkgs</code>.
        </li>
      
        <li>
          We can “extend” this package set to add our own Haskell packages. This is what we do when creating <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>myHaskellPackages</code>.
        </li>
      
        <li>
          We add the <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>todo-app</code> package to <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>myHaskellPackages</code> (a package set derived from <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>pkgs.haskellPackages</code>), and then use that when defining the flake package, <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>packages.${system}.default</code>, below.
        </li>
      
    </ul>
  <div data-callout-metadata data-callout-fold data-callout='tip' class='callout bg-opacity-5 bg-[#f5f5f5] dark:bg-gray-900 p-5 pt-4 pb-3 rounded-xl mb-6 border-l-4 border-gray-200 dark:border-gray-700 shadow-sm' role='note' style='background-color: #08BFBC10; border-left-color: #08BFBC'>
  <path d='M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z'>
  </path>
  <div class='callout-title flex items-center mb-3 font-semibold text-lg' style='color: #08BFBC'>
    <div class='callout-icon flex-shrink-0'>
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='w-5 h-5'>
        
    <path d='M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z'>
    </path>
  
      </svg>
    </div>
    <div class='ml-3'>
       Exploring <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>pkgs.haskellPackages</code>
    </div>
  </div>
  <div class='callout-content text-gray-700 dark:text-gray-300'>
    
    <p class='mb-4 leading-relaxed'>
      You can use <a href='repl' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>nix repl</a> to explore any flake’s output. In the repl session below, we locate and build the <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>aeson</code> package:
    </p>
  <div class='py-4 pr-4 mb-6 text-sm font-mono rounded-lg overflow-x-auto'><pre><code class='nix'>nix repl <span class='va'>github</span><span class='op'>:</span><span class='ss'>nixos/nixpkgs/nixpkgs-unstable</span>
nix<span class='op'>-</span>repl&gt; pkgs = legacyPackages<span class='op'>.</span><span class='sc'>${</span><span class='bu'>builtins</span><span class='op'>.</span>currentSystem<span class='sc'>}</span>

nix<span class='op'>-</span>repl&gt; pkgs<span class='op'>.</span>haskellPackages<span class='op'>.</span>aeson
«derivation <span class='ss'>/nix/store/sjaqjjnizd7ybirh94ixs51x4n17m97h-aeson-2.0.3.0.drv</span>»

nix<span class='op'>-</span>repl&gt; :b pkgs<span class='op'>.</span>haskellPackages<span class='op'>.</span>aeson

This <span class='bu'>derivation</span> produced the following <span class='va'>outputs</span><span class='op'>:</span>
  doc <span class='op'>-</span>&gt; <span class='ss'>/nix/store/xjvm45wxqasnd5p2kk9ngcc0jbjhx1pf-aeson-2.0.3.0-doc</span>
  out <span class='op'>-</span>&gt; <span class='ss'>/nix/store/1dc6b11k93a6j9im50m7qj5aaa5p01wh-aeson-2.0.3.0</span>
</code></pre></div>
  </div>
</div>
    <h3 id='callcabal2nix' class='group mt-10 mb-5 font-semibold text-gray-900 dark:text-gray-50 text-3xl'>
      
  callCabal2nix
  
  <a href='nixify-haskell-nixpkgs#callcabal2nix' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h3>
  
    <p class='mb-4 leading-relaxed'>
      We used <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>callCabal2nix</code> function from <a href='nixpkgs' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>nixpkgs</a> to build the <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>todo-app</code> package above. This functio generates a Haskell package <a href='drv' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>Derivation</a> from its source, utilizing the <a href='https://github.com/NixOS/cabal2nix' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'>“cabal2nix”</a> program to convert a cabal file into a Nix derivation.
    </p>
  
    <h3 id='overlay' class='group mt-10 mb-5 font-semibold text-gray-900 dark:text-gray-50 text-3xl'>
      
  Overlay
  
  <a href='nixify-haskell-nixpkgs#overlay' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h3>
  <div data-callout-metadata data-callout-fold data-callout='info' class='callout bg-opacity-5 bg-[#f5f5f5] dark:bg-gray-900 p-5 pt-4 pb-3 rounded-xl mb-6 border-l-4 border-gray-200 dark:border-gray-700 shadow-sm' role='note' style='background-color: #086DD310; border-left-color: #086DD3'>
  <path d='M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z'>
  </path>
  <div class='callout-title flex items-center mb-3 font-semibold text-lg' style='color: #086DD3'>
    <div class='callout-icon flex-shrink-0'>
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='w-5 h-5'>
        
    <circle cx='12' cy='12' r='10'></circle>
    <line x1='12' y1='16' x2='12' y2='12'></line>
    <line x1='12' y1='8' x2='12.01' y2='8'></line>
  
      </svg>
    </div>
    <div class='ml-3'>
      Info
    </div>
  </div>
  <div class='callout-content text-gray-700 dark:text-gray-300'>
    
    <ul class='my-4 ml-6 space-y-2 list-disc leading-relaxed'>
      
        <li>
          <a href='https://nixos.wiki/wiki/Overlays' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'>NixOS Wiki on Overlays</a>
        </li>
      
        <li>
          <a href='https://github.com/NixOS/nixpkgs/blob/master/lib/fixed-points.nix' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'>Overlay implementation in fixed-points.nix</a>&gt;
        </li>
      
    </ul>
  
  </div>
</div>
    <p class='mb-4 leading-relaxed'>
      To <em>extend</em> the <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>pkgs.haskellPackages</code> package set above, we had to pass what is known as an “overlay”. This allows us to either override an existing package or add a new one.
    </p>
  
    <p class='mb-4 leading-relaxed'>
      In the repl session below, we extend the default Haskell package set to override the <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>shower</code> package to be built from the Git repo instead:
    </p>
  <div class='py-4 pr-4 mb-6 text-sm font-mono rounded-lg overflow-x-auto'><pre><code class='nix'>nix<span class='op'>-</span>repl&gt; :b pkgs<span class='op'>.</span>haskellPackages<span class='op'>.</span>shower

This <span class='bu'>derivation</span> produced the following <span class='va'>outputs</span><span class='op'>:</span>
  doc <span class='op'>-</span>&gt; <span class='ss'>/nix/store/crzcx007h9j0p7qj35kym2rarkrjp9j1-shower-0.2.0.3-doc</span>
  out <span class='op'>-</span>&gt; <span class='ss'>/nix/store/zga3nhqcifrvd58yx1l9aj4raxhcj2mr-shower-0.2.0.3</span>

nix<span class='op'>-</span>repl&gt; myHaskellPackages = pkgs<span class='op'>.</span>haskellPackages<span class='op'>.</span>extend 
    <span class='op'>(</span><span class='va'>self</span><span class='op'>:</span> <span class='va'>super</span><span class='op'>:</span> <span class='op'>{</span>
       <span class='va'>shower</span> <span class='op'>=</span> self<span class='op'>.</span>callCabal2nix <span class='st'>"shower"</span> 
         <span class='op'>(</span>pkgs<span class='op'>.</span>fetchgit <span class='op'>{</span> 
            <span class='va'>url</span> <span class='op'>=</span> <span class='st'>"https://github.com/monadfix/shower.git"</span><span class='op'>;</span>
            <span class='va'>rev</span> <span class='op'>=</span> <span class='st'>"2d71ea1"</span><span class='op'>;</span> 
            <span class='va'>sha256</span> <span class='op'>=</span> <span class='st'>"sha256-vEck97PptccrMX47uFGjoBVSe4sQqNEsclZOYfEMTns="</span><span class='op'>;</span> 
         <span class='op'>})</span> <span class='op'>{};</span> 
    <span class='op'>})</span>

nix<span class='op'>-</span>repl&gt; :b myHaskellPackages<span class='op'>.</span>shower

This <span class='bu'>derivation</span> produced the following <span class='va'>outputs</span><span class='op'>:</span>
  doc <span class='op'>-</span>&gt; <span class='ss'>/nix/store/vkpfbnnzyywcpfj83pxnj3n8dfz4j4iy-shower-0.2.0.3-doc</span>
  out <span class='op'>-</span>&gt; <span class='ss'>/nix/store/55cgwfmayn84ynknhg74bj424q8fz5rl-shower-0.2.0.3</span>
</code></pre></div>
    <p class='mb-4 leading-relaxed'>
      Notice how we used <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>callCabal2nix</code> to build a new Haskell package from the source (located in the specified Git repository).
    </p>
  
    <h3 id='together' class='group mt-10 mb-5 font-semibold text-gray-900 dark:text-gray-50 text-3xl'>
      
  Putting It All Together
  
  <a href='nixify-haskell-nixpkgs#together' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h3>
  <div xmlhtmlRaw><script async id="asciicast-591422" src="https://asciinema.org/a/591422.js" data-speed="3" data-preload="true" data-theme="solarized-light" data-rows="30" data-idleTimeLimit="3"></script>
</div>
    <h2 id='devshell' class='group mt-12 mb-6 font-bold text-gray-900 dark:text-gray-50 pb-2 border-b-2 border-gray-200 dark:border-gray-800 text-4xl'>
      
  Nixifying Development Shells
  
  <a href='nixify-haskell-nixpkgs#devshell' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h2>
  
    <p class='mb-4 leading-relaxed'>
      Our existing flake lets us <em>build</em> <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>todo-app</code>. But what if we want to <em>develop</em> it? Typically, Haskell development involves tools like <a href='https://cabal.readthedocs.io/' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'>cabal</a> and <a href='https://github.com/ndmitchell/ghcid' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'>ghcid</a>. These tools require a GHC environment with the packages specified in the <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>build-depends</code> of our cabal file. This is where <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>devShell</code> comes in, providing an isolated environment with all packages required by the project.
    </p>
  
    <p class='mb-4 leading-relaxed'>
      Here’s the <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>flake.nix</code> for setting up a development shell:
    </p>
  <div class='py-4 pr-4 mb-6 text-sm font-mono rounded-lg overflow-x-auto'><pre><code class='nix'><span class='op'>{</span>
  <span class='va'>inputs</span> <span class='op'>=</span> <span class='op'>{</span>
    <span class='va'>nixpkgs</span>.<span class='va'>url</span> <span class='op'>=</span> <span class='st'>"github:NixOS/nixpkgs/nixpkgs-unstable"</span><span class='op'>;</span>
  <span class='op'>};</span>
  <span class='va'>outputs</span> <span class='op'>=</span> <span class='op'>{</span> <span class='va'>self</span><span class='op'>,</span> <span class='va'>nixpkgs</span> <span class='op'>}</span>:
    <span class='kw'>let</span>
      <span class='va'>system</span> <span class='op'>=</span> <span class='st'>"aarch64-darwin"</span><span class='op'>;</span>
      <span class='va'>pkgs</span> <span class='op'>=</span> nixpkgs<span class='op'>.</span>legacyPackages<span class='op'>.</span><span class='sc'>${</span>system<span class='sc'>}</span><span class='op'>;</span>
      <span class='va'>overlay</span> <span class='op'>=</span> <span class='va'>final</span><span class='op'>:</span> <span class='va'>prev</span><span class='op'>:</span> <span class='op'>{</span>
        <span class='va'>todo-app</span> <span class='op'>=</span> final<span class='op'>.</span>callCabal2nix <span class='st'>"todo-app"</span> <span class='ss'>./.</span> <span class='op'>{</span> <span class='op'>};</span>
      <span class='op'>};</span>
      <span class='va'>myHaskellPackages</span> <span class='op'>=</span> pkgs<span class='op'>.</span>haskellPackages<span class='op'>.</span>extend overlay<span class='op'>;</span>
    <span class='kw'>in</span>
    <span class='op'>{</span>
      <span class='va'>devShells</span>.<span class='sc'>${</span>system<span class='sc'>}</span>.<span class='va'>default</span> <span class='op'>=</span> myHaskellPackages<span class='op'>.</span>shellFor <span class='op'>{</span>
        <span class='va'>packages</span> <span class='op'>=</span> <span class='va'>p</span> <span class='op'>:</span> <span class='op'>[</span>
          p<span class='op'>.</span>todo-app
        <span class='op'>];</span>
        <span class='va'>nativeBuildInputs</span> <span class='op'>=</span> <span class='kw'>with</span> myHaskellPackages<span class='op'>;</span> <span class='op'>[</span>
          ghcid
          cabal-install
        <span class='op'>];</span>
      <span class='op'>};</span>
    <span class='op'>};</span>
<span class='op'>}</span>
</code></pre></div>
    <h3 id='shellfor' class='group mt-10 mb-5 font-semibold text-gray-900 dark:text-gray-50 text-3xl'>
      
  shellFor
  
  <a href='nixify-haskell-nixpkgs#shellfor' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h3>
  
    <p class='mb-4 leading-relaxed'>
      A Haskell <a href='dev' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>devShell</a> can be provided in one of the two ways. The default way is to use the (language-independent) <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>mkShell</code> function (Generic shell). However to get full IDE support, it is best to use the (haskell-specific) <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>shellFor</code> function, which is an abstraction over <a href='https://nixos.org/manual/nixpkgs/stable/#sec-pkgs-mkShell' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'><code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>mkShell</code></a> geared specifically for Haskell development shells
    </p>
  
    <ul class='my-4 ml-6 space-y-2 list-disc leading-relaxed'>
      
        <li>
          Every Haskell package set (such as <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>pkgs.haskellPackages</code>), exposes <a href='https://nixos.wiki/wiki/Haskell#Using_shellFor_.28multiple_packages.29' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'><code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>shellFor</code></a> function, which returns a devShell with GHC package set configured with the Haskell packages in that package set.
        </li>
      
        <li>
          As arguments to <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>shellFor</code> - generally, we only need to define two keys <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>packages</code> and <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>nativeBuildInputs</code>.
    <ul class='my-4 ml-6 space-y-2 list-disc leading-relaxed'>
      
        <li>
          <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>packages</code> refers to <em>local</em> Haskell packages (that will be compiled by cabal rather than Nix).
        </li>
      
        <li>
          <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>nativeBuildInputs</code> refers to programs to make available in the <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>PATH</code> of the devShell.
        </li>
      
    </ul>
  
        </li>
      
    </ul>
  
    <h3 id='lets-run' class='group mt-10 mb-5 font-semibold text-gray-900 dark:text-gray-50 text-3xl'>
      
  Let’s run!
  
  <a href='nixify-haskell-nixpkgs#lets-run' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h3>
  <div xmlhtmlRaw><script async id="asciicast-591426" src="https://asciinema.org/a/591426.js" data-speed="3" data-preload="true" data-theme="solarized-light" data-rows="30" data-idleTimeLimit="3"></script>
</div>
    <h2 id='ext-deps' class='group mt-12 mb-6 font-bold text-gray-900 dark:text-gray-50 pb-2 border-b-2 border-gray-200 dark:border-gray-800 text-4xl'>
      
  Nixifying External Dependencies
  
  <a href='nixify-haskell-nixpkgs#ext-deps' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h2>
  
    <p class='mb-4 leading-relaxed'>
      We looked at how to package a Haskell package, and thereon how to setup a development shell. Now we come to the final part of this tutorial, where we will see how to package external dependencies (like Postgres). We will demonstrate how to initiate a Postgres server using Nix without altering the global system state.
    </p>
  
    <p class='mb-4 leading-relaxed'>
      Here’s the <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>flake.nix</code> for making <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>nix run .#postgres</code> launch a Postgres server:
    </p>
  <div class='py-4 pr-4 mb-6 text-sm font-mono rounded-lg overflow-x-auto'><pre><code class='nix'><span class='op'>{</span>
  <span class='va'>inputs</span> <span class='op'>=</span> <span class='op'>{</span>
    <span class='va'>nixpkgs</span>.<span class='va'>url</span> <span class='op'>=</span> <span class='st'>"github:NixOS/nixpkgs/nixpkgs-unstable"</span><span class='op'>;</span>
  <span class='op'>};</span>
  <span class='va'>outputs</span> <span class='op'>=</span> <span class='op'>{</span> <span class='va'>self</span><span class='op'>,</span> <span class='va'>nixpkgs</span> <span class='op'>}</span>:
  <span class='kw'>let</span>
    <span class='va'>system</span> <span class='op'>=</span> <span class='st'>"aarch64-darwin"</span><span class='op'>;</span>
    <span class='va'>pkgs</span> <span class='op'>=</span> nixpkgs<span class='op'>.</span>legacyPackages<span class='op'>.</span><span class='sc'>${</span>system<span class='sc'>}</span><span class='op'>;</span>
  <span class='kw'>in</span>
  <span class='op'>{</span>
    <span class='va'>apps</span>.<span class='sc'>${</span>system<span class='sc'>}</span>.<span class='va'>postgres</span> <span class='op'>=</span> <span class='op'>{</span>
      <span class='va'>type</span> <span class='op'>=</span> <span class='st'>"app"</span><span class='op'>;</span>
      <span class='va'>program</span> <span class='op'>=</span> 
        <span class='kw'>let</span>
          <span class='va'>script</span> <span class='op'>=</span> pkgs<span class='op'>.</span>writeShellApplication <span class='op'>{</span>
            <span class='va'>name</span> <span class='op'>=</span> <span class='st'>"pg_start"</span><span class='op'>;</span>
            <span class='va'>runtimeInputs</span> <span class='op'>=</span> <span class='op'>[</span> pkgs<span class='op'>.</span>postgresql <span class='op'>];</span>
            <span class='va'>text</span> <span class='op'>=</span> 
            <span class='st'>''</span>
<span class='st'>              # Initialize a database with data stored in current project dir</span>
<span class='st'>              [ ! -d "./data/db" ] && initdb --no-locale -D ./data/db</span>

<span class='st'>              postgres -D ./data/db -k "$PWD"/data</span>
<span class='st'>            ''</span><span class='op'>;</span>
          <span class='op'>};</span>
        <span class='kw'>in</span> <span class='st'>"</span><span class='sc'>${</span>script<span class='sc'>}</span><span class='st'>/bin/pg_start"</span><span class='op'>;</span>
    <span class='op'>};</span>
  <span class='op'>};</span>
<span class='op'>}</span>
</code></pre></div>
    <p class='mb-4 leading-relaxed'>
      This flake defines a flake app that can be run using <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>nix run</code>. This app is simply a shell script that starts a Postgres server. <a href='nixpkgs' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>nixpkgs</a> provides the convenient <a href='writeShellApplication' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'><code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>writeShellApplication</code></a> function to generate such a script. Note that <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>"${script}"</code> provides the path in the <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>nix/store</code> where the application is located.
    </p>
  
    <h3 id='run-it' class='group mt-10 mb-5 font-semibold text-gray-900 dark:text-gray-50 text-3xl'>
      
  Run it!
  
  <a href='nixify-haskell-nixpkgs#run-it' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h3>
  <div xmlhtmlRaw><script async id="asciicast-591427" src="https://asciinema.org/a/591427.js" data-speed="3" data-preload="true" data-theme="solarized-light" data-rows="30" data-idleTimeLimit="3"></script>
</div>
    <h2 id='combine' class='group mt-12 mb-6 font-bold text-gray-900 dark:text-gray-50 pb-2 border-b-2 border-gray-200 dark:border-gray-800 text-4xl'>
      
  Combining All Elements
  
  <a href='nixify-haskell-nixpkgs#combine' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h2>
  
    <p class='mb-4 leading-relaxed'>
      Now it’s time to consolidate all the previously discussed sections into a single <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>flake.nix</code>. Additionally, we should incorporate the necessary apps for <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>postgrest</code> and <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>createdb</code>. <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>postgrest</code> app will start the service and <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>createdb</code> will handle tasks such as loading the database dump, creating a database user, and configuring the database for postgREST.
    </p>
  <div class='py-4 pr-4 mb-6 text-sm font-mono rounded-lg overflow-x-auto'><pre><code class='nix'><span class='op'>{</span>
  <span class='va'>inputs</span> <span class='op'>=</span> <span class='op'>{</span>
    <span class='va'>nixpkgs</span>.<span class='va'>url</span> <span class='op'>=</span> <span class='st'>"github:NixOS/nixpkgs/nixpkgs-unstable"</span><span class='op'>;</span>
  <span class='op'>};</span>
  <span class='va'>outputs</span> <span class='op'>=</span> <span class='op'>{</span> <span class='va'>self</span><span class='op'>,</span> <span class='va'>nixpkgs</span> <span class='op'>}</span>:
    <span class='kw'>let</span>
      <span class='va'>system</span> <span class='op'>=</span> <span class='st'>"aarch64-darwin"</span><span class='op'>;</span>
      <span class='va'>pkgs</span> <span class='op'>=</span> nixpkgs<span class='op'>.</span>legacyPackages<span class='op'>.</span><span class='sc'>${</span>system<span class='sc'>}</span><span class='op'>;</span>
      <span class='va'>overlay</span> <span class='op'>=</span> <span class='va'>final</span><span class='op'>:</span> <span class='va'>prev</span><span class='op'>:</span> <span class='op'>{</span>
        <span class='va'>todo-app</span> <span class='op'>=</span> final<span class='op'>.</span>callCabal2nix <span class='st'>"todo-app"</span> <span class='ss'>./.</span> <span class='op'>{</span> <span class='op'>};</span>
      <span class='op'>};</span>
      <span class='va'>myHaskellPackages</span> <span class='op'>=</span> pkgs<span class='op'>.</span>haskellPackages<span class='op'>.</span>extend overlay<span class='op'>;</span>
    <span class='kw'>in</span>
    <span class='op'>{</span>
      <span class='va'>packages</span>.<span class='sc'>${</span>system<span class='sc'>}</span>.<span class='va'>default</span> <span class='op'>=</span> myHaskellPackages<span class='op'>.</span>todo<span class='op'>-</span>app<span class='op'>;</span>

      <span class='va'>devShells</span>.<span class='sc'>${</span>system<span class='sc'>}</span>.<span class='va'>default</span> <span class='op'>=</span> myHaskellPackages<span class='op'>.</span>shellFor <span class='op'>{</span>
        <span class='va'>packages</span> <span class='op'>=</span> <span class='va'>p</span><span class='op'>:</span> <span class='op'>[</span>
          p<span class='op'>.</span>todo-app
        <span class='op'>];</span>
        <span class='va'>buildInputs</span> <span class='op'>=</span> <span class='kw'>with</span> myHaskellPackages<span class='op'>;</span> <span class='op'>[</span>
          ghcid
          cabal-install
          haskell-language-server
        <span class='op'>];</span>
      <span class='op'>};</span>

      <span class='va'>apps</span>.<span class='sc'>${</span>system<span class='sc'>}</span> <span class='op'>=</span> <span class='op'>{</span>
        <span class='va'>default</span> <span class='op'>=</span> <span class='op'>{</span>
          <span class='va'>type</span> <span class='op'>=</span> <span class='st'>"app"</span><span class='op'>;</span>
          <span class='va'>program</span> <span class='op'>=</span> <span class='st'>"</span><span class='sc'>${</span>self<span class='op'>.</span>packages<span class='op'>.</span><span class='sc'>${</span>system<span class='sc'>}</span><span class='op'>.</span>default<span class='sc'>}</span><span class='st'>/bin/todo-app"</span><span class='op'>;</span>
        <span class='op'>};</span>
        <span class='va'>postgres</span> <span class='op'>=</span> <span class='op'>{</span>
          <span class='va'>type</span> <span class='op'>=</span> <span class='st'>"app"</span><span class='op'>;</span>
          <span class='va'>program</span> <span class='op'>=</span>
            <span class='kw'>let</span>
              <span class='va'>script</span> <span class='op'>=</span> pkgs<span class='op'>.</span>writeShellApplication <span class='op'>{</span>
                <span class='va'>name</span> <span class='op'>=</span> <span class='st'>"pg_start"</span><span class='op'>;</span>
                <span class='va'>runtimeInputs</span> <span class='op'>=</span> <span class='op'>[</span> pkgs<span class='op'>.</span>postgresql <span class='op'>];</span>
                <span class='va'>text</span> <span class='op'>=</span>
                  <span class='st'>''</span>
<span class='st'>                    # Initialize a database with data stored in current project dir</span>
<span class='st'>                    [ ! -d "./data/db" ] && initdb --no-locale -D ./data/db</span>

<span class='st'>                    postgres -D ./data/db -k "$PWD"/data</span>
<span class='st'>                  ''</span><span class='op'>;</span>
              <span class='op'>};</span>
            <span class='kw'>in</span>
            <span class='st'>"</span><span class='sc'>${</span>script<span class='sc'>}</span><span class='st'>/bin/pg_start"</span><span class='op'>;</span>
        <span class='op'>};</span>
        <span class='va'>createdb</span> <span class='op'>=</span> <span class='op'>{</span>
          <span class='va'>type</span> <span class='op'>=</span> <span class='st'>"app"</span><span class='op'>;</span>
          <span class='va'>program</span> <span class='op'>=</span>
            <span class='kw'>let</span>
              <span class='va'>script</span> <span class='op'>=</span> pkgs<span class='op'>.</span>writeShellApplication <span class='op'>{</span>
                <span class='va'>name</span> <span class='op'>=</span> <span class='st'>"createDB"</span><span class='op'>;</span>
                <span class='va'>runtimeInputs</span> <span class='op'>=</span> <span class='op'>[</span> pkgs<span class='op'>.</span>postgresql <span class='op'>];</span>
                <span class='va'>text</span> <span class='op'>=</span>
                  <span class='st'>''</span>
<span class='st'>                    # Create a database of your current user</span>
<span class='st'>                    if ! psql -h "$PWD"/data -lqt | cut -d \| -f 1 | grep -qw "$(whoami)"; then</span>
<span class='st'>                      createdb -h "$PWD"/data "$(whoami)"</span>
<span class='st'>                    fi</span>

<span class='st'>                    # Load DB dump</span>
<span class='st'>                    psql -h "$PWD"/data &lt; db.sql</span>

<span class='st'>                    # Create configuration file for postgrest</span>
<span class='st'>                    echo "db-uri = \"postgres://authenticator:mysecretpassword@localhost:5432/$(whoami)\"</span>
<span class='st'>                    db-schemas = \"api\"</span>
<span class='st'>                    db-anon-role = \"todo_user\"" &gt; data/db.conf</span>
<span class='st'>                  ''</span><span class='op'>;</span>
              <span class='op'>};</span>
            <span class='kw'>in</span>
            <span class='st'>"</span><span class='sc'>${</span>script<span class='sc'>}</span><span class='st'>/bin/createDB"</span><span class='op'>;</span>
        <span class='op'>};</span>
        <span class='va'>postgrest</span> <span class='op'>=</span> <span class='op'>{</span>
          <span class='va'>type</span> <span class='op'>=</span> <span class='st'>"app"</span><span class='op'>;</span>
          <span class='va'>program</span> <span class='op'>=</span>
            <span class='kw'>let</span>
              <span class='va'>script</span> <span class='op'>=</span> pkgs<span class='op'>.</span>writeShellApplication <span class='op'>{</span>
                <span class='va'>name</span> <span class='op'>=</span> <span class='st'>"pgREST"</span><span class='op'>;</span>
                <span class='va'>runtimeInputs</span> <span class='op'>=</span> <span class='op'>[</span> myHaskellPackages<span class='op'>.</span>postgrest <span class='op'>];</span>
                <span class='va'>text</span> <span class='op'>=</span>
                  <span class='st'>''</span>
<span class='st'>                    postgrest ./data/db.conf</span>
<span class='st'>                  ''</span><span class='op'>;</span>
              <span class='op'>};</span>
            <span class='kw'>in</span>
            <span class='st'>"</span><span class='sc'>${</span>script<span class='sc'>}</span><span class='st'>/bin/pgREST"</span><span class='op'>;</span>
        <span class='op'>};</span>
      <span class='op'>};</span>
    <span class='op'>};</span>
<span class='op'>}</span>
</code></pre></div>
    <p class='mb-4 leading-relaxed'>
      For the complete souce code, visit <a href='https://github.com/juspay/todo-app/tree/tutorial/1' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'>here</a>.
    </p>
  <div data-callout-metadata data-callout-fold data-callout='note' class='callout bg-opacity-5 bg-[#f5f5f5] dark:bg-gray-900 p-5 pt-4 pb-3 rounded-xl mb-6 border-l-4 border-gray-200 dark:border-gray-700 shadow-sm' role='note' style='background-color: #086DD310; border-left-color: #086DD3'>
  <path d='M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z'>
  </path>
  <div class='callout-title flex items-center mb-3 font-semibold text-lg' style='color: #086DD3'>
    <div class='callout-icon flex-shrink-0'>
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='w-5 h-5'>
        
    <line x1='18' y1='2' x2='22' y2='6'></line>
    <path d='M7.5 20.5 19 9l-4-4L3.5 16.5 2 22z'></path>
  
      </svg>
    </div>
    <div class='ml-3'>
       <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>forAllSystems</code>
    </div>
  </div>
  <div class='callout-content text-gray-700 dark:text-gray-300'>
    
    <p class='mb-4 leading-relaxed'>
      The source code uses <a href='https://zero-to-nix.com/concepts/flakes#system-specificity' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'><code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>forAllSystems</code></a>, which was not included in the tutorial above to maintain simplicity. Later, we will obviate <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>forAllSystems</code> and simplify the flake further using <a href='flake-parts' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>flake-parts</a>.
    </p>
  
  </div>
</div>
    <h3 id='video-walkthrough' class='group mt-10 mb-5 font-semibold text-gray-900 dark:text-gray-50 text-3xl'>
      
  Video Walkthrough
  
  <a href='nixify-haskell-nixpkgs#video-walkthrough' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h3>
  <div xmlhtmlRaw><script async id="asciicast-591435" src="https://asciinema.org/a/591435.js" data-speed="3" data-preload="true" data-theme="solarized-light" data-rows="30" data-idleTimeLimit="3"></script>
</div>
    <h2 id='conclusion' class='group mt-12 mb-6 font-bold text-gray-900 dark:text-gray-50 pb-2 border-b-2 border-gray-200 dark:border-gray-800 text-4xl'>
      
  Conclusion
  
  <a href='nixify-haskell-nixpkgs#conclusion' class='--ema-anchor ml-2'>
    <span class='text-gray-400 hover:text-green-500 dark:hover:text-green-400 group-hover:opacity-100 opacity-0 cursor-pointer text-sm align-middle transition-opacity' aria-label='Copy link' title='Copy link to heading'><svg class='inline w-5 h-5' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
        <path d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'></path>
        <path d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'></path>
      </svg></span>
  </a>


    </h2>
  
    <p class='mb-4 leading-relaxed'>
      This tutorial pratically demonstrated <a href='why-dev' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>why Nix is a great choice for Haskell development</a>:
    </p>
  
    <ul class='my-4 ml-6 space-y-2 list-disc leading-relaxed'>
      
        <li>
          <strong>Instantaneous Onboarding</strong>: There is no confusion about how to setup the development environment. It is <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>nix run .#postgres</code> to start the postgres server, <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>nix run .#createdb</code> to setup the database and <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>nix run .#postgrest</code> to start the Postgrest web server. This happens in a reproducible way, ensuring every developer gets the same environment.
        </li>
      
        <li>
          <strong>Boosted Productivity</strong>: The commands mentioned in the previous points in conjunction with <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>nix develop</code> is all that is needed to make a quick change and see it in effect.
        </li>
      
        <li>
          <strong>Multi-Platform Support</strong>: All the commands mentioned in the previous points will work in the same way across platforms.
        </li>
      
    </ul>
  
    <p class='mb-4 leading-relaxed'>
      In the next tutorial part, we will modularize this <code class='py-1 px-2 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 font-mono rounded border border-gray-200 dark:border-gray-700 text-[0.9em]'>flake.nix</code> using <a href='flake-parts' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>flake-parts</a>.
    </p>
  
  <!-- Disabled until we can limit this template to a subset of notes (blog posts):
     https://github.com/nixos-asia/website/issues/9

<aside class="flex items-center justify-center mt-2">
  <ema:metadata>
    <span id="yamlauthor" class="mb-4 text-right text-gray-600">
      Written by
      <value var="author" />
    </span>
  </ema:metadata>
  <script>if (yamlauthor.innerText.includes('error')) yamlauthor.innerText = ''</script>
</aside>
--><div class='flex items-center justify-center mt-2'>
  <div class='flex items-center justify-center mt-2'>
    
      
        <a class='text-gray-300 hover:text-green-600 text-sm' title='Edit this page on GitHub' href='https://github.com/nixos-asia/website/edit/master/en/nixify-haskell-nixpkgs.md'>
          <svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z'></path>
          </svg>
        </a>
      
    
  </div>
</div>
</article>
    
    <div class='flex flex-col lg:flex-row lg:space-x-4 mt-8'>
      
      
  <div class='flex-1 p-5 mt-8 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-lg shadow-sm'>
    <header class='mb-4 text-sm font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400'>Links to this page</header>
    <ul class='space-y-2'>
      
        <li>
          <a class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900 inline-block' href='direnv'>
            <code>direnv</code>: manage dev environments
          </a>
          
            <div class='mb-4 overflow-auto text-sm text-gray-500 dark:text-gray-300'>
  
    <div class='pl-2 mt-2 border-l-2 border-green-200 dark:border-green-600 hover:border-green-500 dark:hover:border-green-400'>
      <div><p>Since both <a href='nixify-haskell-nixpkgs' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkNormal'>nixpkgs</a> and <a href='https://community.flake.parts/haskell-flake' class='text-green-600 dark:text-green-400 underline decoration-1 hover:decoration-2' data-linkicon='external' target='_blank' rel='noopener'>haskell-flake</a> use Nix expressions that read the <code>.cabal</code> file to get dependency information, you will want the devshell be recreated every time a <code>.cabal</code> file changes. This can be achieved using the <code>watch_file</code> function. Modify your <code>.envrc</code> to contain:</p></div>
    </div>
  
</div>
          
        </li>
      
        <li>
          <a class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900 inline-block' href='nixify-haskell'>
            Nixify Haskell projects
          </a>
          
            <div class='mb-4 overflow-auto text-sm text-gray-500 dark:text-gray-300'>
  
    <div class='pl-2 mt-2 border-l-2 border-green-200 dark:border-green-600 hover:border-green-500 dark:hover:border-green-400'>
      <div>
          <svg xmlns='http://www.w3.org/2000/svg' class='inline h-4 w-4 mb-1 text-gray-600 stroke-current fill-current' viewBox='0 0 28 28'><desc>☑</desc><rect stroke-width='3' x='2' y='2' width='24' height='24' rx='3'></rect><path stroke='white' fill='none' stroke-linejoin='round' stroke-width='3.5' d='M7 14 l6 5L22 8'></path></svg>
<span>
  
            <a href='nixify-haskell-nixpkgs' class='text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-950 px-1.5 py-0.5 rounded-md font-semibold no-underline hover:bg-green-100 dark:hover:bg-green-900' data-wikilink-type='WikiLinkBranch'>Nixifying a Haskell project using nixpkgs</a>
          
</span>
        </div>
    </div>
  
</div>
          
        </li>
      
    </ul>
  </div>

    </div>
    
  <section class='flex flex-wrap items-end justify-center my-4 space-x-2 space-y-2 font-mono text-sm'>
    
  </section>

    <!-- What goes in this file will at the very end of the main div -->
  </main>
</div>
        </div>
      
      <footer class='flex items-center justify-center mt-10 mb-10'>
  <div class='inline-flex items-center justify-center space-x-6 px-8 py-4 bg-gray-50 dark:bg-gray-900 rounded-lg'>
    
  <div>
    
      
        <a href='/en/' title='Go to Home'>
          <svg xmlns='http://www.w3.org/2000/svg' class='w-8 h-8 text-gray-600 dark:text-gray-400 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-950 p-1.5 rounded-md transition-all hover:shadow-md hover:-translate-y-0.5' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6'></path>
          </svg>
        </a>
      
    
  </div>
  <div>
    <a href='-/all' title='View Index'>
      <svg xmlns='http://www.w3.org/2000/svg' class='w-8 h-8 text-gray-600 dark:text-gray-400 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-950 p-1.5 rounded-md transition-all hover:shadow-md hover:-translate-y-0.5' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253'></path>
      </svg>
    </a>
  </div>
  <div>
    <a href='https://emanote.srid.ca' target='_blank' title='Generated by Emanote 1.5.4.1'>
      <img class='w-8 h-8 text-gray-600 dark:text-gray-400 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-950 p-1.5 rounded-md transition-all hover:shadow-md hover:-translate-y-0.5' src='_emanote-static/emanote-logo.svg' alt='Emanote logo' />
    </a>
  </div>
  <div>
    <a href='-/tags' title='View tags'>
      <svg class='w-8 h-8 text-gray-600 dark:text-gray-400 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-950 p-1.5 rounded-md transition-all hover:shadow-md hover:-translate-y-0.5' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z'>
        </path>
      </svg>
    </a>
  </div>
  <div>
    <a href='-/tasks' title='View tasks'>
      <svg xmlns='http://www.w3.org/2000/svg' class='w-8 h-8 text-gray-600 dark:text-gray-400 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-950 p-1.5 rounded-md transition-all hover:shadow-md hover:-translate-y-0.5' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'></path>
      </svg>
    </a>
  </div>
  </div>
</footer>
    </div>
  
  <div id='stork-search-container' class='hidden fixed w-screen h-screen inset-0 backdrop-filter backdrop-blur-sm'>
  <div class='fixed w-screen h-screen inset-0' onclick='window.emanote.stork.toggleSearch()'></div>

  <div class='container mx-auto p-10 mt-10'>
    <div id='stork-wrapper' class='container mx-auto'>
      <input id='stork-search-input' data-stork='emanote-search' class='stork-input' placeholder='Search (Ctrl+K) ...' />
      <div data-stork='emanote-search-output' class='stork-output'></div>
    </div>
  </div>
</div>

<script>
  const wrapper = document.getElementById('stork-wrapper');
  const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  wrapper.classList.add(isDark ? 'stork-wrapper-edible-dark' : 'stork-wrapper-edible');

  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
    wrapper.classList.remove('stork-wrapper-edible', 'stork-wrapper-edible-dark');
    wrapper.classList.add(e.matches ? 'stork-wrapper-edible-dark' : 'stork-wrapper-edible');
  });
</script>
  
    
  
</body>

</html>
